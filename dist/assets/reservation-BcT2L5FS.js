var g=(t,e,a)=>new Promise((s,n)=>{var i=o=>{try{d(a.next(o))}catch(c){n(c)}},l=o=>{try{d(a.throw(o))}catch(c){n(c)}},d=o=>o.done?s(o.value):Promise.resolve(o.value).then(i,l);d((a=a.apply(t,e)).next())});import"./main-1wRwdB3J.js";import{g as p,i as b,s as m,f as E,a as I,b as k}from"./utils-BuTwOXtE.js";import{r as w,h as R}from"./api-CctCSKT1.js";let r,u,y,f;function S(){return new URLSearchParams(window.location.search).get("restaurant")}function B(){if(r=document.getElementById("reservationForm"),u=document.getElementById("successMessage"),y=document.getElementById("makeAnother"),f=S(),!r||!u||!y){console.error("Required form elements not found");return}const t=document.getElementById("date");if(t){const e=new Date().toISOString().split("T")[0];t.min=e}D(),L(),r.addEventListener("submit",x),y.addEventListener("click",A)}function D(){if(!f)return;const e={rest_1:{name:"ReserVee Beşiktaş",address:"Barbaros Bulvarı No:15, Beşiktaş"},rest_2:{name:"Bosphorus Café",address:"Ortaköy Meydanı No:8, Beşiktaş"},rest_3:{name:"ReserVee Kadıköy",address:"Bahariye Caddesi No:42, Kadıköy"}}[f];if(e){const a=document.createElement("div");a.className="selected-restaurant-info",a.innerHTML='\n      <div class="restaurant-selection">\n        <h3>Selected Restaurant</h3>\n        <div class="restaurant-details">\n          <strong>'.concat(e.name,"</strong>\n          <span>").concat(e.address,'</span>\n        </div>\n        <button type="button" id="changeRestaurant" class="change-restaurant-btn">Change Restaurant</button>\n      </div>\n    '),r.parentNode.insertBefore(a,r),document.getElementById("changeRestaurant").addEventListener("click",()=>{window.location.href="index.html"})}}function L(){r.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("blur",()=>v(e)),e.addEventListener("input",()=>h(e))})}function v(t){const e=t.value.trim(),a=t.name;let s=!0,n="";if(t.hasAttribute("required")&&!e)s=!1,n="This field is required.";else switch(a){case"fullName":e&&e.length<2&&(s=!1,n="Name must be at least 2 characters long.");break;case"phoneNumber":e&&!b(e)&&(s=!1,n="Please enter a valid phone number.");break;case"email":e&&!k(e)&&(s=!1,n="Please enter a valid email address.");break;case"date":if(e){const i=new Date(e),l=new Date;l.setHours(0,0,0,0),i<l&&(s=!1,n="Please select a future date.")}break;case"time":if(e){const i=new Date(document.getElementById("date").value),l=new Date,[d,o]=e.split(":"),c=new Date(i);c.setHours(parseInt(d),parseInt(o)),i.toDateString()===l.toDateString()&&c<=l&&(s=!1,n="Please select a future time.")}break}return q(t,s?"":n),s}function q(t,e){const a=document.getElementById("".concat(t.name,"Error"));e?(t.classList.add("error"),a.textContent=e):(t.classList.remove("error"),a.textContent="")}function h(t){t.classList.remove("error");const e=document.getElementById("".concat(t.name,"Error"));e.textContent=""}function N(){const t=r.querySelectorAll("input[required], select[required]");let e=!0;return t.forEach(a=>{v(a)||(e=!1)}),e}function x(t){return g(this,null,function*(){if(t.preventDefault(),!N())return;const e=r.querySelector('button[type="submit"]'),a=e.textContent;e.textContent="Saving...",e.disabled=!0;try{const s=new FormData(r),n={id:p(),restaurantId:f||"general",fullName:s.get("fullName"),phoneNumber:s.get("phoneNumber"),email:s.get("email"),date:s.get("date"),time:s.get("time"),guests:s.get("guests"),specialRequests:s.get("specialRequests")||"",createdAt:new Date().toISOString()},i=yield C(n);P(n),i.fallback?console.warn("⚠️ Reservation saved locally only"):console.log("✅ Reservation saved to backend successfully")}catch(s){console.error("❌ Failed to save reservation:",s),alert("Rezervasyon kaydedilemedi. Lütfen tekrar deneyin.")}finally{e.textContent=a,e.disabled=!1}})}function C(t){return g(this,null,function*(){try{const e=yield w.create(t);console.log("✅ Reservation saved to backend:",e);const a=m.get("reservations")||[];return a.push(t),m.set("reservations",a),e}catch(e){console.warn("⚠️ Backend save failed, using localStorage fallback");const a=R(e,"saving reservation"),s=m.get("reservations")||[];return s.push(t),m.set("reservations",s),console.warn("Reservation saved locally:",a.userMessage),{success:!0,data:t,fallback:!0}}})}function P(t){r.style.display="none";const e=document.querySelector(".selected-restaurant-info");e&&(e.style.display="none"),u.classList.remove("hidden");const a=u.querySelector(".success-content p");a.innerHTML="\n    Your reservation for ".concat(t.guests," guest").concat(t.guests>1?"s":"","\n    on ").concat(E(t.date)," at ").concat(I(t.time)," has been confirmed.\n  ")}function A(){r.reset(),r.style.display="block";const t=document.querySelector(".selected-restaurant-info");t&&(t.style.display="block"),u.classList.add("hidden"),r.querySelectorAll("input, select, textarea").forEach(s=>h(s));const a=document.getElementById("date");if(a){const s=new Date().toISOString().split("T")[0];a.min=s}}document.addEventListener("DOMContentLoaded",B);

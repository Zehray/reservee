import"./main-B6YXdTMh.js";import{g as h,i as p,s as c,f as b,a as E,b as I}from"./utils-BuTwOXtE.js";import{r as k,h as w}from"./api-ZOE00wgz.js";let n,l,u,d;function R(){return new URLSearchParams(window.location.search).get("restaurant")}function S(){if(n=document.getElementById("reservationForm"),l=document.getElementById("successMessage"),u=document.getElementById("makeAnother"),d=R(),!n||!l||!u){console.error("Required form elements not found");return}const t=document.getElementById("date");if(t){const e=new Date().toISOString().split("T")[0];t.min=e}B(),D(),n.addEventListener("submit",N),u.addEventListener("click",P)}function B(){if(!d)return;const e={rest_1:{name:"ReserVee Beşiktaş",address:"Barbaros Bulvarı No:15, Beşiktaş"},rest_2:{name:"Bosphorus Café",address:"Ortaköy Meydanı No:8, Beşiktaş"},rest_3:{name:"ReserVee Kadıköy",address:"Bahariye Caddesi No:42, Kadıköy"}}[d];if(e){const s=document.createElement("div");s.className="selected-restaurant-info",s.innerHTML=`
      <div class="restaurant-selection">
        <h3>Selected Restaurant</h3>
        <div class="restaurant-details">
          <strong>${e.name}</strong>
          <span>${e.address}</span>
        </div>
        <button type="button" id="changeRestaurant" class="change-restaurant-btn">Change Restaurant</button>
      </div>
    `,n.parentNode.insertBefore(s,n),document.getElementById("changeRestaurant").addEventListener("click",()=>{window.location.href="index.html"})}}function D(){n.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("blur",()=>f(e)),e.addEventListener("input",()=>g(e))})}function f(t){const e=t.value.trim(),s=t.name;let a=!0,r="";if(t.hasAttribute("required")&&!e)a=!1,r="This field is required.";else switch(s){case"fullName":e&&e.length<2&&(a=!1,r="Name must be at least 2 characters long.");break;case"phoneNumber":e&&!p(e)&&(a=!1,r="Please enter a valid phone number.");break;case"email":e&&!I(e)&&(a=!1,r="Please enter a valid email address.");break;case"date":if(e){const o=new Date(e),i=new Date;i.setHours(0,0,0,0),o<i&&(a=!1,r="Please select a future date.")}break;case"time":if(e){const o=new Date(document.getElementById("date").value),i=new Date,[y,v]=e.split(":"),m=new Date(o);m.setHours(parseInt(y),parseInt(v)),o.toDateString()===i.toDateString()&&m<=i&&(a=!1,r="Please select a future time.")}break}return L(t,a?"":r),a}function L(t,e){const s=document.getElementById(`${t.name}Error`);e?(t.classList.add("error"),s.textContent=e):(t.classList.remove("error"),s.textContent="")}function g(t){t.classList.remove("error");const e=document.getElementById(`${t.name}Error`);e.textContent=""}function q(){const t=n.querySelectorAll("input[required], select[required]");let e=!0;return t.forEach(s=>{f(s)||(e=!1)}),e}async function N(t){if(t.preventDefault(),!q())return;const e=n.querySelector('button[type="submit"]'),s=e.textContent;e.textContent="Saving...",e.disabled=!0;try{const a=new FormData(n),r={id:h(),restaurantId:d||"general",fullName:a.get("fullName"),phoneNumber:a.get("phoneNumber"),email:a.get("email"),date:a.get("date"),time:a.get("time"),guests:a.get("guests"),specialRequests:a.get("specialRequests")||"",createdAt:new Date().toISOString()},o=await x(r);C(r),o.fallback?console.warn("⚠️ Reservation saved locally only"):console.log("✅ Reservation saved to backend successfully")}catch(a){console.error("❌ Failed to save reservation:",a),alert("Rezervasyon kaydedilemedi. Lütfen tekrar deneyin.")}finally{e.textContent=s,e.disabled=!1}}async function x(t){try{const e=await k.create(t);console.log("✅ Reservation saved to backend:",e);const s=c.get("reservations")||[];return s.push(t),c.set("reservations",s),e}catch(e){console.warn("⚠️ Backend save failed, using localStorage fallback");const s=w(e,"saving reservation"),a=c.get("reservations")||[];return a.push(t),c.set("reservations",a),console.warn("Reservation saved locally:",s.userMessage),{success:!0,data:t,fallback:!0}}}function C(t){n.style.display="none";const e=document.querySelector(".selected-restaurant-info");e&&(e.style.display="none"),l.classList.remove("hidden");const s=l.querySelector(".success-content p");s.innerHTML=`
    Your reservation for ${t.guests} guest${t.guests>1?"s":""}
    on ${b(t.date)} at ${E(t.time)} has been confirmed.
  `}function P(){n.reset(),n.style.display="block";const t=document.querySelector(".selected-restaurant-info");t&&(t.style.display="block"),l.classList.add("hidden"),n.querySelectorAll("input, select, textarea").forEach(a=>g(a));const s=document.getElementById("date");if(s){const a=new Date().toISOString().split("T")[0];s.min=a}}document.addEventListener("DOMContentLoaded",S);
